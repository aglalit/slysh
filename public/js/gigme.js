"use strict";function tunaInit(){tuna=new Tuna(audioContext);var e=new tuna.Chorus({rate:1.5,feedback:.2,delay:.0045,bypass:0});new tuna.Phaser({rate:1.2,depth:.3,feedback:.2,stereoPhase:30,baseModulationFrequency:700,bypass:0}),new tuna.Compressor({threshold:-1,makeupGain:20,attack:1,release:0,ratio:4,knee:5,automakeup:!1,bypass:0}),new tuna.MoogFilter({cutoff:.465,resonance:2,bufferSize:1024}),new tuna.Convolver({highCut:22050,lowCut:20,dryLevel:1,wetLevel:1,level:1,impulse:"impulses/ir_rev_short.wav",bypass:0}),new tuna.PingPongDelay({wetLevel:1,feedback:.5,delayTimeLeft:150,delayTimeRight:200}),new tuna.Delay({feedback:.5,delayTime:100,wetLevel:1,dryLevel:1,cutoff:2e4,bypass:0});input=audioContext.createGain(),output=audioContext.createGain(),input.connect(e),e.connect(output),output.connect(audioContext.destination)}function midiOscInit(){function e(e){loadedSamples[e[1]]&&(144==e[0]?(window["source"+e[1]]=audioContext.createBufferSource(),window["source"+e[1]].buffer=loadedSamples[e[1]],window["source"+e[1]].connect(input),window["source"+e[1]].start()):128==e[0]&&window["source"+e[1]].stop())}midiMessageEventHandler=function(o){e(o)}}window.AudioContext=window.AudioContext||window.webkitAudioContext;var audioContext=void 0,tuna=void 0,midinote=void 0,loadedSamples={},midiMessageEventHandler=void 0,input=void 0,output=void 0,ws=new WebSocket("ws://192.168.2.1:8080");ws.onopen=function(e){console.log("Connection to server opened")},ws.onerror=function(e){console.log("Error:",e)},ws.onclose=function(e){console.log("Connection closed")},ws.onmessage=function(e){data=e.data,console.log(data),midinote=data.split(","),midiMessageEventHandler(midinote)};var samplesSrc=[36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72];document.querySelector("#run").addEventListener("click",function(){audioContext=new AudioContext;var e=audioContext.createOscillator();e.connect(audioContext.destination),e.start(),e.stop(1),tunaInit(),midiOscInit();var o=samplesSrc.map(function(e){var o=new XMLHttpRequest;o.open("GET","moog/"+e+"....wav",!0),o.responseType="arraybuffer",o.send(),o.onload=function(){audioContext.decodeAudioData(o.response,function(o){loadedSamples[e]=o})},o.onerror=function(e){console.log(e)}});Promise.all(o).then(function(){console.log("All "+o.length+" files ready")}).catch(function(e){console.log("An error occurred while occurred while loading files"),console.log(e)})});